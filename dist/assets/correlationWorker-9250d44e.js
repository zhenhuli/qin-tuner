(function(){"use strict";var S=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},q={},W={},A=S&&S.__assign||function(){return A=Object.assign||function(c){for(var t,h=1,F=arguments.length;h<F;h++){t=arguments[h];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(c[n]=t[n])}return c},A.apply(this,arguments)};Object.defineProperty(W,"__esModule",{value:!0});var ir={threshold:.1,sampleRate:44100,probabilityThreshold:.1};function lr(c){c===void 0&&(c={});var t=A(A({},ir),c),h=t.threshold,F=t.sampleRate,n=t.probabilityThreshold;return function(g){var r;for(r=1;r<g.length;r*=2);r/=2;for(var s=r/2,f=new Float32Array(s),M=0,v,e=0;e<s;e++)f[e]=0;for(var e=1;e<s;e++)for(var y=0;y<s;y++){var b=g[y]-g[y+e];f[e]+=b*b}f[0]=1,f[1]=1;for(var p=0,e=1;e<s;e++)p+=f[e],f[e]*=e/p;for(v=2;v<s;v++)if(f[v]<h){for(;v+1<s&&f[v+1]<f[v];)v++;M=1-f[v];break}if(v===s||f[v]>=h||M<n)return null;var m,a,o;if(v<1?a=v:a=v-1,v+1<s?o=v+1:o=v,a===v)f[v]<=f[o]?m=v:m=o;else if(o===v)f[v]<=f[a]?m=v:m=a;else{var i=f[a],l=f[v],u=f[o];m=v+(u-i)/(2*(2*l-u-i))}return F/m}}W.YIN=lr;var Y={},C=S&&S.__assign||function(){return C=Object.assign||function(c){for(var t,h=1,F=arguments.length;h<F;h++){t=arguments[h];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(c[n]=t[n])}return c},C.apply(this,arguments)};Object.defineProperty(Y,"__esModule",{value:!0});var fr={sampleRate:44100,minFrequency:82,maxFrequency:1e3,ratio:5,sensitivity:.1};function or(c){c===void 0&&(c={});var t=C(C({},fr),c),h=t.sampleRate,F=t.minFrequency,n=t.maxFrequency,_=t.sensitivity,g=t.ratio,r=[],s=Math.ceil(h/F),f=Math.floor(h/n);return function(v){var e=v.length,y=0,b=1/0,p=-1/0,m,a,o,i,l,u,P,O;for(i=0;i<e;i++)if(f<=i&&i<=s){for(P=0,O=i,y=0,m=[],a=[];P<e-i;y++,O++,P++)m[y]=v[P],a[y]=v[O];var L=m.length;for(o=[],u=0;u<L;u++)o[u]=m[u]-a[u];var d=0;for(u=0;u<L;u++)d+=Math.abs(o[u]);r[i]=d}for(l=f;l<s;l++)r[l]<b&&(b=r[l]),r[l]>p&&(p=r[l]);var w=Math.round(_*(p-b)+b);for(l=f;l<=s&&r[l]>w;l++);var T=f/2;b=r[l];var E=l;for(i=l-1;i<l+T&&i<=s;i++)r[i]<b&&(b=r[i],E=i);return Math.round(r[E]*g)<p?h/E:null}}Y.AMDF=or;var z={},U=S&&S.__assign||function(){return U=Object.assign||function(c){for(var t,h=1,F=arguments.length;h<F;h++){t=arguments[h];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(c[n]=t[n])}return c},U.apply(this,arguments)};Object.defineProperty(z,"__esModule",{value:!0});var J={sampleRate:44100};function cr(c){c===void 0&&(c=J);var t=U(U({},J),c),h=t.sampleRate;return function(n){var _=n.length,g=0,r,s,f,M;for(r=0;r<_;r++)M=n[r],g+=M*M;if(g=Math.sqrt(g/_),g<.01)return-1;var v=0,e=_-1,y=.2;for(r=0;r<_/2;r++)if(Math.abs(n[r])<y){v=r;break}for(r=1;r<_/2;r++)if(Math.abs(n[_-r])<y){e=_-r;break}var b=n.slice(v,e),p=b.length,m=new Array(p).fill(0);for(r=0;r<p;r++)for(s=0;s<p-r;s++)m[r]=m[r]+b[s]*b[s+r];for(f=0;m[f]>m[f+1];)f++;var a=-1,o=-1;for(r=f;r<p;r++)m[r]>a&&(a=m[r],o=r);var i=o,l=m[i-1],u=m[i],P=m[i+1],O=(l+P-2*u)/2,L=(P-l)/2;return O&&(i=i-L/(2*O)),h/i}}z.ACF2PLUS=cr;var X={},I=S&&S.__assign||function(){return I=Object.assign||function(c){for(var t,h=1,F=arguments.length;h<F;h++){t=arguments[h];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(c[n]=t[n])}return c},I.apply(this,arguments)};Object.defineProperty(X,"__esModule",{value:!0});var sr=6,ur=3e3,hr=3,gr=.75,mr={sampleRate:44100};function yr(c){c===void 0&&(c={});var t=I(I({},mr),c),h=t.sampleRate;return function(n){for(var _=[],g=[],r=n.length,s=null,f=0,M=0,v=0,e=0;e<r;e++){var y=n[e];f=f+y,v=Math.max(v,y),M=Math.min(M,y)}f/=r,M-=f,v-=f;for(var b=v>-1*M?v:-1*M,p=b*gr,m=0,a=-1,o=n.length,i,l,u;i=~~(h/(Math.pow(2,m)*ur)),!(o<2);){var P=void 0,O=-1e3,L=-1e6,d=-1e6,w=!1,T=!1;u=0,l=0;for(var e=2;e<o;e++){var E=n[e]-f,H=n[e-1]-f;H<=0&&E>0&&(w=!0),H>=0&&E<0&&(T=!0),P=E-H,O>-1e3&&(T&&O<0&&P>=0&&Math.abs(E)>=p&&e>L+i&&(_[u++]=e,L=e,T=!1),w&&O>0&&P<=0&&Math.abs(E)>=p&&e>d+i&&(g[l++]=e,d=e,w=!1)),O=P}if(u===0&&l===0)break;for(var tr=void 0,j=[],e=0;e<o;e++)j[e]=0;for(var e=0;e<u;e++)for(var R=1;R<hr;R++)e+R<u&&(tr=Math.abs(_[e]-_[e+R]),j[tr]+=1);for(var D=-1,G=-1,e=0;e<o;e++){for(var N=0,R=-1*i;R<=i;R++)e+R>=0&&e+R<o&&(N+=j[e+R]);N===G?e===2*D&&(D=e):N>G&&(G=N,D=e)}for(var k=0,vr=0,R=-i;R<=i;R++)if(D+R>=0&&D+R<r){var Q=j[D+R];Q>0&&(vr+=Q,k+=(D+R)*Q)}if(k/=vr,a>-1&&Math.abs(k*2-a)<=2*i){s=h/(Math.pow(2,m-1)*a);break}if(a=k,m++,m>=sr||o<2)break;var V=n.subarray(0);o===j.length&&(V=new Float32Array(o/2));for(var e=0;e<o/2;e++)V[e]=(n[2*e]+n[2*e+1])/2;n=V,o/=2}return s}}X.DynamicWavelet=yr;var $={},x=S&&S.__assign||function(){return x=Object.assign||function(c){for(var t,h=1,F=arguments.length;h<F;h++){t=arguments[h];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(c[n]=t[n])}return c},x.apply(this,arguments)};Object.defineProperty($,"__esModule",{value:!0});var _r={bufferSize:1024,cutoff:.97,sampleRate:44100};function pr(c){c===void 0&&(c={});var t=x(x({},_r),c),h=t.bufferSize,F=t.cutoff,n=t.sampleRate,_=.5,g=80,r=new Float32Array(h),s=new Float32Array(h),f,M,v=[],e=[],y=[];function b(a){var o,i;s[0]=a[0]*a[0];for(var l=1;l<a.length;l+=1)s[l]=a[l]*a[l]+s[l-1];for(var u=0;u<a.length;u++){o=0,i=s[a.length-1-u]+s[a.length-1]-s[u];for(var l=0;l<a.length-u;l++)o+=a[l]*a[l+u];r[u]=2*o/i}}function p(a){var o=r[a-1],i=r[a],l=r[a+1],u=a,P=l+o-2*i;if(P===0)f=u,M=i;else{var O=o-l;f=u+O/(2*P),M=i-O*O/(8*P)}}function m(){for(var a=0,o=0;a<(r.length-1)/3&&r[a]>0;)a++;for(;a<r.length-1&&r[a]<=0;)a++;for(a==0&&(a=1);a<r.length-1;)if(r[a]>r[a-1]&&r[a]>=r[a+1]&&(o==0||r[a]>r[o])&&(o=a),a++,a<r.length-1&&r[a]<=0)for(o>0&&(v.push(o),o=0);a<r.length-1&&r[a]<=0;)a++;o>0&&v.push(o)}return function(o){var i;v=[],e=[],y=[],b(o),m();for(var l=-1/0,u=0;u<v.length;u++){var P=v[u];l=Math.max(l,r[P]),r[P]>_&&(p(P),y.push(M),e.push(f),l=Math.max(l,M))}if(e.length){for(var O=F*l,L=0,u=0;u<y.length;u++)if(y[u]>=O){L=u;break}var d=e[L],w=n/d;w>g?i=w:i=-1}else i=-1;return{probability:l,freq:i}}}$.Macleod=pr;var K={};(function(c){var t=S&&S.__assign||function(){return t=Object.assign||function(n){for(var _,g=1,r=arguments.length;g<r;g++){_=arguments[g];for(var s in _)Object.prototype.hasOwnProperty.call(_,s)&&(n[s]=_[s])}return n},t.apply(this,arguments)};Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_FREQUENCIES_PARAMS={tempo:120,quantization:4,sampleRate:44100};function h(n,_){var g=n.map(function(y){return y(_)}).filter(function(y){return y!==null}).sort(function(y,b){return y-b});if(g.length===1)return g[0];if(g.length===2){var r=g[0],s=g[1];return r*2>s?Math.sqrt(r*s):r}else{var r=g[0],s=g[1],f=g[g.length-2],M=g[g.length-1],v=r*2>s?g:g.slice(1),e=f*2>M?v:v.slice(0,-1);return Math.pow(e.reduce(function(p,m){return p*m},1),1/e.length)}}function F(n,_,g){g===void 0&&(g={});var r=t(t({},c.DEFAULT_FREQUENCIES_PARAMS),g),s=r.tempo,f=r.quantization,M=r.sampleRate,v=_.length,e=Math.round(M*60/(f*s)),y;Array.isArray(n)?y=h.bind(null,n):y=n;for(var b=[],p=0,m=v-e;p<=m;p+=e){var a=_.slice(p,p+e),o=y(a);b.push(o)}return b}c.frequencies=F})(K),Object.defineProperty(q,"__esModule",{value:!0});var Z=W;q.YIN=Z.YIN;var B=Y;q.AMDF=B.AMDF;var rr=z;q.ACF2PLUS=rr.ACF2PLUS;var er=X;q.DynamicWavelet=er.DynamicWavelet;var ar=$;q.Macleod=ar.Macleod;var nr=K;q.frequencies=nr.frequencies;var br=q.default={YIN:Z.YIN,AMDF:B.AMDF,ACF2PLUS:rr.ACF2PLUS,DynamicWavelet:er.DynamicWavelet,Macleod:ar.Macleod,frequencies:nr.frequencies};self.addEventListener("message",c=>{const{buffer:t,sampleRate:h}=c.data,n=br.AMDF({sampleRate:h,minFrequency:10})(t);self.postMessage({frequency:n})})})();
